<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Management</title>
  <!-- Include Tailwind CSS via CDN or your existing CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
        font-family: 'Inter', sans-serif;
    }
    /* Custom styles for modal */
    .modal {
        display: none; /* Hidden by default - THIS IS THE FIX */
        position: fixed; /* Stay in place */
        z-index: 1000; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
        align-items: center; /* Center content vertically */
        justify-content: center; /* Center content horizontally */
    }
    .modal-content {
        background-color: #fefefe;
        padding: 2rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-width: 28rem; /* Equivalent to w-96 max-w-md */
        width: 100%;
    }
    .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }
    .close-button:hover,
    .close-button:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
  </style>
</head>
<body class="min-h-screen bg-gray-100 p-4 flex flex-col items-center">
<div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-6xl">
  <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Employee Management System</h1>

  <!-- Search and Filter Section -->
  <form th:action="@{/employees}" method="get" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <input
            type="text"
            name="employeeId"
            placeholder="Search by ID"
            class="p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            th:value="${searchTermId}"
    />
    <input
            type="text"
            name="name"
            placeholder="Search by Name"
            class="p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            th:value="${searchTermName}"
    />
    <select
            name="department"
            class="p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
    >
      <option value="">All Departments</option>
      <option th:each="dep : ${allDepartments}"
              th:value="${dep}"
              th:text="${dep}"
              th:selected="${dep == selectedDepartment}"></option>
    </select>
    <select
            name="jobTitle"
            class="p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
    >
      <option value="">All Job Titles</option>
      <option th:each="job : ${allJobTitles}"
              th:value="${job}"
              th:text="${job}"
              th:selected="${job == selectedJobTitle}"></option>
    </select>
    <button type="submit" class="col-span-full md:col-span-4 lg:col-span-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
      Apply Filters
    </button>
  </form>

  <!-- Employee List Table -->
  <div class="overflow-x-auto rounded-lg border border-gray-200">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Job Title</th>
      </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
      <tr th:if="${#lists.isEmpty(employees)}">
        <td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">No employees found matching your criteria.</td>
      </tr>
      <tr th:each="employee : ${employees}" class="hover:bg-gray-50">
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" th:text="${employee.employeeId}"></td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 hover:text-blue-800 cursor-pointer"
            th:data-employee-id="${employee.employeeId}" onclick="showEmployeeDetails(this.dataset.employeeId)">
          <span th:text="${employee.firstName + ' ' + employee.lastName}"></span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" th:text="${employee.department}"></td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" th:text="${employee.jobTitle}"></td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination Controls -->
  <div class="flex justify-center mt-6">
    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
      <a th:href="@{/employees(page=${currentPage - 2}, size=${pageSize}, employeeId=${searchTermId}, name=${searchTermName}, department=${selectedDepartment}, jobTitle=${selectedJobTitle})}"
         th:classappend="${currentPage == 1} ? 'opacity-50 cursor-not-allowed pointer-events-none' : ''"
         class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
        Previous
      </a>
      <th:block th:each="i : ${#numbers.sequence(1, totalPages)}">
        <a th:href="@{/employees(page=${i - 1}, size=${pageSize}, employeeId=${searchTermId}, name=${searchTermName}, department=${selectedDepartment}, jobTitle=${selectedJobTitle})}"
           th:classappend="${i == currentPage} ? 'z-10 bg-blue-50 border-blue-500 text-blue-600' : 'bg-white text-gray-700 hover:bg-gray-50'"
           class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium">
          <span th:text="${i}"></span>
        </a>
      </th:block>
      <a th:href="@{/employees(page=${currentPage}, size=${pageSize}, employeeId=${searchTermId}, name=${searchTermName}, department=${selectedDepartment}, jobTitle=${selectedJobTitle})}"
         th:classappend="${currentPage == totalPages || totalPages == 0} ? 'opacity-50 cursor-not-allowed pointer-events-none' : ''"
         class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
        Next
      </a>
    </nav>
  </div>
</div>

<!-- Employee Detail Modal -->
<div id="employeeDetailModal" class="modal">
  <div class="modal-content">
    <span class="close-button" onclick="closeEmployeeDetails()">&times;</span>
    <h2 class="text-2xl font-bold mb-4 text-gray-800">Employee Details</h2>
    <div id="modalDetails" class="mb-4">
      <!-- Details will be loaded here by JavaScript -->
      <p class="text-sm text-gray-600 mb-1"><strong>ID:</strong> <span id="detailId"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Name:</strong> <span id="detailName"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Department:</strong> <span id="detailDepartment"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Job Title:</strong> <span id="detailJobTitle"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Email:</strong> <span id="detailEmail"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Phone:</strong> <span id="detailPhone"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Hire Date:</strong> <span id="detailHireDate"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Salary:</strong> <span id="detailSalary"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Address:</strong> <span id="detailAddress"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>City:</strong> <span id="detailCity"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>State/Province:</strong> <span id="detailStateProvince"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Zip/Postal Code:</strong> <span id="detailZipPostalCode"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Country:</strong> <span id="detailCountry"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Date of Birth:</strong> <span id="detailDateOfBirth"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Emergency Contact Name:</strong> <span id="detailEmergencyContactName"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Emergency Contact Phone:</strong> <span id="detailEmergencyContactPhone"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Manager ID:</strong> <span id="detailManagerId"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Status:</strong> <span id="detailStatus"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Employment Type:</strong> <span id="detailEmploymentType"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Last Performance Review:</strong> <span id="detailLastPerformanceReviewDate"></span></p>
      <p class="text-sm text-gray-600 mb-1"><strong>Skills:</strong> <span id="detailSkills"></span></p>
    </div>
    <button
            onclick="closeEmployeeDetails()"
            class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
    >
      Close
    </button>
  </div>
</div>

<script th:inline="javascript">
  /*<![CDATA[*/
  function showEmployeeDetails(employeeId) {
      // Fetch detailed employee data from the backend API
      fetch('/employees/api/' + employeeId) // Adjusted path for the API endpoint
          .then(response => {
              if (!response.ok) {
                  throw new Error('Network response was not ok');
              }
              return response.json();
          })
          .then(employee => {
              // Populate modal with fetched data
              document.getElementById('detailId').textContent = employee.employeeId;
              document.getElementById('detailName').textContent = employee.firstName + ' ' + employee.lastName;
              document.getElementById('detailDepartment').textContent = employee.department;
              document.getElementById('detailJobTitle').textContent = employee.jobTitle;
              document.getElementById('detailEmail').textContent = employee.email;
              document.getElementById('detailPhone').textContent = employee.phoneNumber;
              document.getElementById('detailHireDate').textContent = employee.hireDate;
              document.getElementById('detailSalary').textContent = employee.salary;
              document.getElementById('detailAddress').textContent = employee.address;
              document.getElementById('detailCity').textContent = employee.city;
              document.getElementById('detailStateProvince').textContent = employee.stateProvince;
              document.getElementById('detailZipPostalCode').textContent = employee.zipPostalCode;
              document.getElementById('detailCountry').textContent = employee.country;
              document.getElementById('detailDateOfBirth').textContent = employee.dateOfBirth;
              document.getElementById('detailEmergencyContactName').textContent = employee.emergencyContactName;
              document.getElementById('detailEmergencyContactPhone').textContent = employee.emergencyContactPhone;
              document.getElementById('detailManagerId').textContent = employee.managerId || 'N/A';
              document.getElementById('detailStatus').textContent = employee.status;
              document.getElementById('detailEmploymentType').textContent = employee.employmentType;
              document.getElementById('detailLastPerformanceReviewDate').textContent = employee.lastPerformanceReviewDate;
              document.getElementById('detailSkills').textContent = employee.skills;


              document.getElementById('employeeDetailModal').style.display = 'flex'; // Show the modal
          })
          .catch(error => {
              console.error('Error fetching employee details:', error);
              alert('Could not load employee details. Please try again.'); // Using alert for simple demo
          });
  }

  function closeEmployeeDetails() {
      document.getElementById('employeeDetailModal').style.display = 'none'; // Hide the modal
  }

  // Close modal when clicking outside of it
  window.onclick = function(event) {
      const modal = document.getElementById('employeeDetailModal');
      if (event.target == modal) {
          modal.style.display = 'none';
      }
  }
  /*]]>*/
</script>
</body>
</html>
